{% extends "base.html" %}
{% block content %}
<div class="weight-page">
  <a class="back-link" style="color: dodgerblue" href="{% url 'boxer_list' %}">‚Üê Back to Boxers</a>
    <h2 class="page-title">‚öñÔ∏è Weight Progress ‚Äî {{ boxer.name }}</h2>

  <!-- Fighting weight input -->
  <form method="get" class="fw-bar">
    <label>
      Fighting Weight (kg)
      <input type="number" name="fighting_weight" step="0.1" min="0"
             value="{{ fighting_weight|default_if_none:'' }}" placeholder="e.g. 72.5">
    </label>
    <button class="btn btn--primary" type="submit">Apply</button>
  </form>

  {% if fw_error %}
    <p class="error-text">{{ fw_error }}</p>
  {% endif %}

  <div class="weight-card">
    {% if rows %}
      <!-- Summary -->
      <section class="summary-grid">
        <div class="summary-item"><span class="label">Min</span><span class="value">{{ min_w }} kg</span></div>
        <div class="summary-item"><span class="label">Max</span><span class="value">{{ max_w }} kg</span></div>
        <div class="summary-item"><span class="label">Range</span><span class="value">{{ diff|default:"‚Äì" }} kg</span></div>
        <div class="summary-item"><span class="label">Above FW{% if fighting_weight %} ({{ fighting_weight }}kg){% endif %}</span><span class="value">{{ count_above_fw|default:"‚Äì" }}</span></div>
        <div class="summary-item"><span class="label">Average</span><span class="value">{{ avg_w|floatformat:2 }} kg</span></div>
      </section>

      <!-- Chart -->
      <section class="chart-box">
        <h3 class="chart-title">üìä History</h3>
        <canvas id="weightChart"></canvas>
      </section>

      <!-- History -->
      <section class="history-box">
        <h3 class="history-title">All Records</h3>
        <div class="history-grid">
          {% for r in rows %}
            <article class="history-item">
              <div class="history-date">{{ r.date|date:"d M Y (D)" }}</div>
              <div class="history-weight"><span class="chip">{{ r.weight }} kg</span></div>
            </article>
          {% endfor %}
        </div>
      </section>
    {% else %}
      <p class="muted">No recorded weights yet for {{ boxer.name }}.</p>
    {% endif %}
  </div>
</div>

<style>
/* Page wrapper */
.weight-page {
  max-width: 800px;
  margin: 0 auto;
  padding: 16px;
}

/* Fighting weight form */
.fw-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 16px;
}
.fw-bar input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: #0f0f0f;
  color: var(--text);
}

/* Main card wrapper */
.weight-card {
  background: linear-gradient(145deg, #0f0f0f, #1c1c1c);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  display: grid;
  gap: 20px;
}

/* Summary section */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(120px,1fr));
  gap: 16px;
}
.summary-item {
  text-align: center;
  padding: 10px;
  border-radius: 10px;
  background: #111;
  box-shadow: inset 0 0 6px rgba(0,255,102,0.1);
}
.summary-item .label { font-size: 13px; color: var(--muted); }
.summary-item .value { font-size: 18px; font-weight: 700; }

/* Chart */
.chart-box {
  padding: 12px;
  border-radius: 12px;
  background: #111;
  border: 1px solid var(--border);
}
.chart-box canvas { width: 100% !important; height: 320px !important; }

/* History */
.history-grid {
  display: grid;
  gap: 12px;
  grid-template-columns: 1fr;
}
@media(min-width:600px){
  .history-grid { grid-template-columns: repeat(2,1fr); }
}
.history-item {
  display:flex; justify-content:space-between; align-items:center;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: #121212;
}
.history-date { font-weight: 600; color: var(--brand); }
.chip { background:#1e1e1e; padding:4px 10px; border-radius:999px; border:1px solid var(--border); font-weight:700; }
</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function() {
  const labels = [{% for r in rows %}"{{ r.date|date:'Y-m-d' }}"{% if not forloop.last %},{% endif %}{% endfor %}];
  const data   = [{% for r in rows %}{{ r.weight }}{% if not forloop.last %},{% endif %}{% endfor %}];

  const datasets = [{
    label: 'Weight (kg)',
    data,
    borderColor: 'rgba(0,255,102,0.9)',
    backgroundColor: 'rgba(0,255,102,0.15)',
    borderWidth: 2,
    pointRadius: 3,
    tension: 0.25
  }];

  {% if fighting_weight %}
  datasets.push({
    label: 'Fighting Weight',
    data: labels.map(() => {{ fighting_weight }}),
    borderColor: 'rgba(255,99,132,0.9)',
    borderDash: [6,6],
    borderWidth: 2,
    pointRadius: 0,
    fill: false
  });
  {% endif %}

  new Chart(document.getElementById('weightChart').getContext('2d'), {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { labels: { color: '#e7e9ee' } } },
      scales: {
        x: { ticks: { color: '#a9afbd' } },
        y: { ticks: { color: '#a9afbd' } }
      }
    }
  });
})();
</script>
{% endblock %}
