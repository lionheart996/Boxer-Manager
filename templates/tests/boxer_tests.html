{% extends "base.html" %}
{% block content %}

<h2 class="page-title futuristic-title">
  ü•ä <span>{{ boxer.first_name }} {{ boxer.last_name }}</span> ‚Äî Test Results
</h2>

<!-- Tests Grid -->
<div class="tests-grid">
  {% for t in tests %}
    {% if t.has_results %}
      <a href="?test={{ t.id }}" class="test-item has-results" data-loading>
        <span class="test-name">{{ t.name }}</span>
        {% if t.unit %}<span class="unit">[{{ t.unit }}]</span>{% endif %}
      </a>
    {% else %}
      <div class="test-item no-results">
        <span class="test-name">{{ t.name }}</span>
        {% if t.unit %}<span class="unit">[{{ t.unit }}]</span>{% endif %}
        <span class="muted small">No results yet</span>
      </div>
    {% endif %}
  {% empty %}
    <p>No tests defined.</p>
  {% endfor %}
</div>

{% if selected_test %}
  <h3 class="section-title neon-subtitle">
    ‚ö° Progress for {{ selected_test.name }} {% if unit %}({{ unit }}){% endif %}
  </h3>

  <!-- Summary -->
  <div class="summary-card futuristic-panel">
    <h4>üìå Summary</h4>
    {% if summary %}
      <ul>
        {% for row in summary %}
          <li>
            <strong>{{ row.avg|floatformat:2 }}</strong>{% if unit %} {{ unit }}{% endif %}
            <span class="muted"> ‚Äî {{ row.date|date:"Y-m-d" }}</span>
            {% if row.notes %}
              <br><span class="notes">üìù {{ row.notes|join:", " }}</span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted"><em>No results yet.</em></p>
    {% endif %}
  </div>

  <!-- Chart -->
  {{ labels|json_script:"labels-data" }}
  {{ values|json_script:"values-data" }}
  <div class="chart-box futuristic-panel">
    <canvas id="progressChart"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    (function(){
      const labels = JSON.parse(document.getElementById('labels-data').textContent || "[]");
      const values = JSON.parse(document.getElementById('values-data').textContent || "[]");
      if (!labels.length) return;

      const ctx = document.getElementById('progressChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: '{{ selected_test.name|escapejs }}{% if unit %} ({{ unit|escapejs }}){% endif %}',
            data: values,
            tension: 0.4,
            pointRadius: 5,
            pointBackgroundColor: '#00ffcc',
            borderWidth: 3,
            borderColor: '#00ff99',
            backgroundColor: '#00ff99',
            fill: false,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              ticks: { color: "#aaa" },
              title: { display: true, text: "Date", color: "#0ff" },
              grid: { color: "rgba(0,255,136,0.2)" },
            },
            y: {
              ticks: { color: "#aaa" },
              title: { display: true, text: "{{ unit|default:'Value'|escapejs }}", color: "#0ff" },
              grid: { color: "rgba(0,255,136,0.1)" },
            }
          },
          plugins: {
            legend: { labels: { color: "#eee" } },
          }
        }
      });
    })();
  </script>
{% endif %}

<style>
/* === Futuristic Typography === */
.futuristic-title {
  font-size: 1.8rem;
  text-align: center;
  color: #00ffcc;
  text-shadow: 0 0 10px #00ffcc, 0 0 20px rgba(0,255,136,0.3);
  border-bottom: 1px solid rgba(0,255,136,0.2);
  padding-bottom: 10px;
  margin-bottom: 1.2rem;
}

.neon-subtitle {
  font-size: 1.2rem;
  text-align: center;
  color: #00ff88;
  text-shadow: 0 0 8px rgba(0,255,136,0.6);
  margin-top: 1.5rem;
}

/* === Tests Grid === */
.tests-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
  animation: fadeIn .6s ease-out;
}

.test-item {
  padding: 1rem;
  border-radius: 14px;
  font-weight: 600;
  text-align: center;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  border: 1px solid rgba(0,255,136,0.25);
  background: linear-gradient(135deg, rgba(0,255,136,0.06), rgba(0,255,136,0.02));
  box-shadow: 0 0 10px rgba(0,255,136,0.1), inset 0 0 10px rgba(0,255,136,0.05);
}

.has-results {
  color: #00ff99;
  cursor: pointer;
}
.has-results:hover {
  background: rgba(0,255,136,0.1);
  box-shadow: 0 0 18px rgba(0,255,136,0.4);
  transform: translateY(-3px);
}
.no-results {
  color: #777;
  border: 1px solid rgba(150,150,150,0.2);
  background: linear-gradient(135deg, #111, #0a0a0a);
  box-shadow: inset 0 0 8px rgba(255,255,255,0.05);
  cursor: not-allowed;
}
.no-results .muted {
  display: block;
  font-size: 0.8rem;
  color: #999;
  margin-top: 6px;
}
.unit {
  display: block;
  font-size: 0.85rem;
  opacity: 0.7;
  margin-top: 3px;
}

/* === Shared glass panel style === */
.futuristic-panel {
  background: rgba(10,10,10,0.85);
  border: 1px solid rgba(0,255,136,0.25);
  border-radius: 16px;
  box-shadow: 0 0 12px rgba(0,255,136,0.2), inset 0 0 20px rgba(0,255,136,0.05);
  backdrop-filter: blur(8px);
  padding: 1rem 1.2rem;
}

/* === Summary Card === */
.summary-card h4 { margin-bottom: 0.5rem; color: #00ff99; }
.summary-card ul { list-style: none; margin: 0; padding: 0; display: grid; gap: 0.6rem; }
.summary-card li { font-size: 15px; color: #ddd; }
.summary-card .muted { color: #aaa; font-size: 13px; }
.summary-card .notes { color: #ffcc00; font-size: 13px; }

/* === Chart Box === */
.chart-box {
  position: relative;
  height: 360px;
  max-width: 100%;
  margin-top: 1rem;
  border-radius: 16px;
}

/* === Animations === */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* === Mobile === */
@media (max-width: 640px) {
  .futuristic-title { font-size: 1.5rem; }
  .tests-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
  .test-item { padding: 0.9rem; font-size: 0.9rem; }
}
</style>

{% endblock %}
