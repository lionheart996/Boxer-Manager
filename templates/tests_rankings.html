{% extends "base.html" %}
{% block content %}
<h2 class="page-title" style="margin-left:75px;">Rankings</h2>

<style>
  .tests-chipbar { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 16px; }
  .chip { padding:6px 10px; border:1px solid #00ff66; border-radius:999px; text-decoration:none; }
  .chip.active { background:#00ff66; color:#000; }
  .record-number { color:#00ff66; font-weight:700; }
  .rankline { padding:6px 10px; border-bottom:1px solid #222; }
  .rankno { width:28px; display:inline-block; }
  .muted { color:#8a8a8a; font-size:12px; }
  .filters { display:flex; align-items:center; gap:12px; margin: 6px 0 14px; }
  .filters select, .filters button { padding:6px 10px; }
</style>

{% if not tests %}
  <p>No tests yet. <a class="btn" href="{% url 'tests_list' %}">Create one</a>.</p>
{% else %}

  <!-- Test picker (preserve phase in the URL) -->
  <div class="tests-chipbar">
    {% for t in tests %}
      <a class="chip {% if selected_test and t.id == selected_test.id %}active{% endif %}"
         href="{% url 'tests_rankings_for_test' t.id %}?phase={{ selected_phase }}">
        {{ t.name }}{% if t.unit %} [{{ t.unit }}]{% endif %}
      </a>
    {% endfor %}
  </div>

  <!-- Phase dropdown -->
  <form class="filters"
        method="get"
        action="{% if selected_test %}{% url 'tests_rankings_for_test' selected_test.id %}{% else %}{% url 'tests_rankings' %}{% endif %}">
    <label for="phase">Phase:</label>
    <select id="phase" name="phase">
      {% for value,label in phase_choices %}
        <option value="{{ value }}" {% if value == selected_phase %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <button type="submit">Apply</button>
  </form>

  {% if not selected_test %}
    <p>Select a test to see rankings.</p>
  {% else %}
    {% if rows %}
      <ol style="list-style:none; padding-left:0; margin:0;">
        {% for row in rows %}
          <li class="rankline">
            <span class="rankno">{{ forloop.counter }}.</span>
            {{ row.boxer.name }}â€™s record is
            <span class="record-number">{{ row.best|floatformat:2 }}</span>
            {% if selected_test.unit %} {{ selected_test.unit }}{% endif %}
            {% if selected_phase == "all" %}
              <span class="muted">({{ row.phase_label }})</span>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p>No results recorded{% if selected_phase != "all" %} for the selected phase{% endif %} for <strong>{{ selected_test.name }}</strong>.</p>
    {% endif %}
  {% endif %}
{% endif %}
{% endblock %}